

---
layout: post
read_time: true
show_date: true
title: "Django ê¸°ë°˜ AI í€´ì¦ˆ ìƒì„± í”Œë«í¼ í”„ë¡œì íŠ¸ êµ¬ì¡° ë¶„ì„"
date: 2025-11-11 23:59:00 +0900
description: Django 5.1.6 ê¸°ë°˜ì˜ AI í€´ì¦ˆ ìƒì„± í”Œë«í¼(Quizly) í”„ë¡œì íŠ¸ì˜ ë””ë ‰í„°ë¦¬ êµ¬ì¡°ì™€ ê° íŒŒì¼/í´ë”ì˜ ì—­í• ì„ ìƒì„¸íˆ ë¶„ì„í•œ ê¸€ì…ë‹ˆë‹¤.
img: posts/20251114/Django.png
tags: [Django, Python, í”„ë¡œì íŠ¸êµ¬ì¡°, AI, ì›¹ê°œë°œ]
author: Juwon
github: JuWunpark/juwon_blog
---

## 1. ê°œë°œ í™˜ê²½ ì„¸íŒ…

### 1-1. ê°€ìƒí™˜ê²½(venv) ë¬¸ì œ

ì²˜ìŒì—ëŠ” ìœˆë„ìš°ìš© ê²½ë¡œë¡œ í™œì„±í™”í•˜ë ¤ë‹¤ê°€ ê³„ì† ì—ëŸ¬ê°€ ë‚¬ë‹¤.

```bash
# âŒ ì´ë ‡ê²Œ í•´ì„œ ê³„ì† ì—ëŸ¬
cd Scripts/activate
source Scripts/activate

# âœ… Mac / Linux ì—ì„œëŠ” ì´ë ‡ê²Œ í•´ì•¼ í•¨
cd "/Users/bagjuwon/Downloads/project - APIì œê±°"
python3 -m venv venv
source venv/bin/activate
````

* `Scripts/activate` ëŠ” **ìœˆë„ìš°ìš©**
* Macì—ì„œëŠ” `bin/activate` ë¥¼ ì‚¬ìš©í•´ì•¼ í•œë‹¤.

---

## 2. Django + MySQL ì—°ë™

### 2-1. settings.py ì„¤ì •

```python
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.mysql',
        'NAME': 'project_db',
        'USER': 'project_user',
        'PASSWORD': '1234',  # ì‹¤ì œë¡œëŠ” .envë¡œ ë¹¼ëŠ” ê²Œ ì¢‹ìŒ
        'HOST': 'localhost',
        'PORT': '3306',
        'OPTIONS': {
            'charset': 'utf8mb4',
        },
    }
}
```

### 2-2. Access denied(1045) ì—ëŸ¬

* `mysql -u root -p` ëŠ” ë¹„ë°€ë²ˆí˜¸ í•„ìš”
* `mysql -u root` ë¡œëŠ” ê·¸ëƒ¥ ì ‘ì†ë˜ëŠ” ìƒí™©ì´ì—ˆìŒ
* MySQL ìª½ ì‚¬ìš©ì/ê¶Œí•œ ë¬¸ì œ í™•ì¸ í›„ `project_user` ê³„ì •ìœ¼ë¡œ ì‹¤ì œ ì ‘ì† í…ŒìŠ¤íŠ¸

---

## 3. OpenAI API ì—°ë™ & .env ì •ë¦¬

### 3-1. ì²˜ìŒ ì—ëŸ¬: UnicodeEncodeError

ë·°ì—ì„œ API í‚¤ë¥¼ ì´ë ‡ê²Œ ë°•ì•„ ë„£ì—ˆì„ ë•Œ:

```python
client = openai.Client(
    api_key='API ì œê±°ë¨!'
)
```

ìš”ì²­ í—¤ë”ì— ë“¤ì–´ê°€ëŠ” ë¬¸ìì—´ì— í•œê¸€ì´ ì„ì´ë©´ì„œ

> `'ascii' codec can't encode characters â€¦`

ê°™ì€ ì—ëŸ¬ê°€ ë°œìƒí–ˆë‹¤.

### 3-2. .env + settings.py ë¡œ ë¶„ë¦¬

`.env` íŒŒì¼:

```env
OPENAI_API_KEY=sk-í”„ë¡œì íŠ¸í‚¤...
```

`settings.py`:

```python
from pathlib import Path
import os
from dotenv import load_dotenv

BASE_DIR = Path(__file__).resolve().parent.parent

load_dotenv()  # .env ë¡œë“œ

OPENAI_API_KEY = os.getenv("OPENAI_API_KEY")
```

`views.py`:

```python
from django.conf import settings
import openai

client = openai.Client(
    api_key=settings.OPENAI_API_KEY
)
```

ì´ë ‡ê²Œ í•´ì„œ

* ì½”ë“œì— í‚¤ë¥¼ ì§ì ‘ ì•ˆ ë„£ê³ 
* ì¸ì½”ë”© ë¬¸ì œë„ í•´ê²°í–ˆë‹¤.

---

## 4. Google Slides / Drive API ì—°ë™

### 4-1. í•„ìš”í•œ íŒ¨í‚¤ì§€ ì„¤ì¹˜

```bash
pip install google-api-python-client google-auth-httplib2 google-auth-oauthlib
```

ì„¤ì¹˜ ì „ì—ëŠ”

> `ModuleNotFoundError: No module named 'googleapiclient'`

ì—ëŸ¬ê°€ ë‚¬ë‹¤.

### 4-2. OAuth ì„¤ì •

1. Google Cloud Console ì—ì„œ ìƒˆ í”„ë¡œì íŠ¸ ìƒì„±
2. **OAuth ë™ì˜ í™”ë©´**

   * ì‚¬ìš©ì ìœ í˜•: ì™¸ë¶€
   * í…ŒìŠ¤íŠ¸ ì‚¬ìš©ìì— ë‚´ êµ¬ê¸€ ê³„ì • ì¶”ê°€
3. **OAuth í´ë¼ì´ì–¸íŠ¸ ID ìƒì„±**

   * ì• í”Œë¦¬ì¼€ì´ì…˜ ìœ í˜•: **ë°ìŠ¤í¬í†± ì•±**
   * JSON ë‹¤ìš´ë¡œë“œ â†’ `client_secret.json` ì´ë¦„ìœ¼ë¡œ í”„ë¡œì íŠ¸ ë£¨íŠ¸ì— ì €ì¥
4. ìµœì´ˆ ì‹¤í–‰ ì‹œ `InstalledAppFlow` ë¡œ ë¸Œë¼ìš°ì €ì—ì„œ ë¡œê·¸ì¸ â†’ `token.json` ìƒì„±

---

## 5. create_slides í•¨ìˆ˜ êµ¬ì¡°

í•µì‹¬ ì—­í• :
**í…œí”Œë¦¿ ìŠ¬ë¼ì´ë“œë¥¼ ë³µì‚¬ â†’ í…ìŠ¤íŠ¸ êµì²´ â†’ ê¶Œí•œ ê³µê°œ â†’ ë§í¬ ë°˜í™˜**

```python
def create_slides(original_file_id, SLIDE_TITLE_TEXT):
    global presentation_id
    SCOPES = [
        'https://www.googleapis.com/auth/presentations',
        'https://www.googleapis.com/auth/drive',
    ]

    # 1) token ë¡œë“œ & OAuth ì¸ì¦
    #    (token.json ì—†ê±°ë‚˜ ê¹¨ì ¸ ìˆìœ¼ë©´ ìƒˆë¡œ ì¸ì¦)
    ...

    service = build('slides', 'v1', credentials=creds)
    drive_service = build('drive', 'v3', credentials=creds)

    try:
        # 2) í…œí”Œë¦¿ ë³µì‚¬
        presentation = drive_service.files().copy(
            fileId=original_file_id,
            fields='id,name,webViewLink',
            body={'name': SLIDE_TITLE_TEXT},
        ).execute()

        presentation_id = presentation['id']
        presentation_link = presentation['webViewLink']

        # 3) í”„ë ˆì  í…Œì´ì…˜ êµ¬ì¡°ë¥¼ JSON íŒŒì¼ë¡œ ì €ì¥
        presentation = service.presentations().get(
            presentationId=presentation_id
        ).execute()

        with open("presentation_data.json", "w", encoding="utf-8") as f:
            json.dump(presentation, f, ensure_ascii=False, indent=4)

        # 4) í…ìŠ¤íŠ¸ ë¦¬ìŠ¤íŠ¸ ìƒì„± & objectId ë§¤í•‘
        text_list = get_textlist_from_txt()
        ...
        mapped_data = dict(zip(object_index, text_list))

        requests_update = []
        # 5) ìŠ¬ë¼ì´ë“œì˜ ê° í…ìŠ¤íŠ¸ ìš”ì†Œë¥¼ ìˆœíšŒí•˜ë©´ì„œ
        #    deleteText + insertText ìš”ì²­ì„ ìŒ“ìŒ
        for slide in data["slides"]:
            for element in slide.get("pageElements", []):
                obj_id = element.get("objectId")
                if obj_id in mapped_data:
                    ...
                    requests_update.append({... deleteText ...})
                    requests_update.append({... insertText ...})

        permission = {
            "type": "anyone",
            "role": "reader",
        }

        # 6) requests_updateê°€ ìˆì„ ë•Œë§Œ batchUpdate í˜¸ì¶œ
        slides_service = build('slides', 'v1', credentials=creds)
        if requests_update:
            slides_service.presentations().batchUpdate(
                presentationId=presentation_id,
                body={'requests': requests_update},
            ).execute()
        else:
            print("âš ï¸ requests_updateê°€ ë¹„ì–´ ìˆì–´ì„œ batchUpdateë¥¼ ê±´ë„ˆëœ€")

        # 7) ëˆ„êµ¬ë‚˜ ì½ê¸° ê°€ëŠ¥í•œ ë§í¬ë¡œ ê³µìœ 
        drive_service.permissions().create(
            fileId=presentation_id,
            body=permission,
            fields="id",
        ).execute()

        # 8) ìµœì¢… ë§í¬ ë°˜í™˜
        return presentation_link

    except Exception as e:
        print("âŒ create_slides ì—ëŸ¬:", e)
        return None
```

ì—¬ê¸°ì„œ `original_file_id` ëŠ” **í…œí”Œë¦¿ í”„ë ˆì  í…Œì´ì…˜ ID**
(ì˜ˆ: `1BD_IbF8x62MsUNlFGbWSmt4v7rpMR5us8BxIwmvMZ9I`)

---

## 6. í…œí”Œë¦¿ ì„ íƒ (prompt.html)

`prompt.html`ì—ì„œ ì²´í¬ë°•ìŠ¤ valueë¡œ í…œí”Œë¦¿ IDë¥¼ ë„˜ê¹€:

```html
<label class="label_check_box">
  <input type="checkbox"
         id="presentation_id"
         class="single-checkbox"
         name="presentation_id"
         value="1BD_IbF8x62MsUNlFGbWSmt4v7rpMR5us8BxIwmvMZ9I">
  <span class="custom-checkbox"></span>
</label>
```

ì˜ˆì „ì— ì“°ë˜ autoppt í…œí”Œë¦¿ IDë¥¼ ê·¸ëŒ€ë¡œ ë‘ì–´ì„œ

> `HttpError 404 â€¦ File not found ...`

ê°€ ê³„ì† ë‚¬ê³ ,
â†’ **ë‚´ ê³„ì •ìœ¼ë¡œ ë§Œë“  ìƒˆ í…œí”Œë¦¿ ID**ë¡œ êµì²´í•´ì„œ í•´ê²°í–ˆë‹¤.

---

## 7. UserHistory ëª¨ë¸ & prompt ë·°

### 7-1. UserHistory ëª¨ë¸

```python
class UserHistory(models.Model):
    user = models.ForeignKey(settings.AUTH_USER_MODEL, on_delete=models.CASCADE)
    ppt_title = models.CharField(max_length=500)
    ppt_url = models.CharField(max_length=500)
    create_date = models.DateTimeField(auto_now_add=True)

    def __str__(self):
        return f"{self.user.username} - {self.ppt_url}"
```

### 7-2. prompt ë·° íë¦„

```python
@login_required(login_url='/login/')
def prompt(request):
    user_id = request.user.id

    global SLIDE_TITLE_TEXT, filename, ppt_link

    if request.method == "POST":
        # 1) í…œí”Œë¦¿ ID + ì‚¬ìš©ì ì…ë ¥ ë°›ê¸°
        presentation_id = request.POST.get("presentation_id")
        SLIDE_TITLE_TEXT = request.POST.get("user-input", "").strip()

        # 2) ì…ë ¥ì„ ê¸°ë°˜ìœ¼ë¡œ íŒŒì¼ëª… ìƒì„± (OpenAI)
        input_string = re.sub(r"[^\w\s.\-\(\)]", "", SLIDE_TITLE_TEXT).replace("\n", "")
        filename_prompt = (
            f'Generate a short, descriptive filename based on: "{input_string}". '
            f'Answer just with the short filename, no explanation.'
        )
        filename_response = client.chat.completions.create(
            model="gpt-3.5-turbo-1106",
            messages=[{"role": "system", "content": filename_prompt}],
            temperature=0.5,
            max_tokens=30,
        )
        filename = filename_response.choices[0].message.content.strip().replace(" ", "_")

        # 3) í´ë” ìƒì„± (ì´ë¯¸ ìˆìœ¼ë©´ ì¬ì‚¬ìš©)
        dir_name = filename
        os.makedirs(dir_name, exist_ok=True)
        SLIDE_TITLE_TEXT = dir_name

        # 4) PPT ë‚´ìš© ìƒì„± ë° ìŠ¬ë¼ì´ë“œ ë¶„í• 
        ppt_text = create_ppt_text(filename)
        split_slides(ppt_text, index=0)

        ppt_detail_text = create_ppt_detail_text()
        split_slides(ppt_detail_text, index=2)

        # 5) êµ¬ê¸€ ìŠ¬ë¼ì´ë“œ ìƒì„± + ë§í¬ ë°›ê¸°
        ppt_link = create_slides(presentation_id, filename)
        print("ğŸ‘‰ ppt_link =", ppt_link)

        # 6) ë§í¬ ìƒì„± ì‹¤íŒ¨ì‹œ DB ì €ì¥ ë§‰ê¸°
        if not ppt_link:
            return HttpResponse("ìŠ¬ë¼ì´ë“œ ë§í¬ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. í„°ë¯¸ë„ ë¡œê·¸ë¥¼ í™•ì¸í•˜ì„¸ìš”.")

        # 7) íˆìŠ¤í† ë¦¬ ì €ì¥
        UserHistory.objects.create(
            user_id=user_id,
            ppt_url=ppt_link,
            ppt_title=filename,
        )

        return redirect('result')
    else:
        return render(request, 'blog/prompt.html')
```

---

## 8. ì¤‘ê°„ì— ë§Œë‚¬ë˜ ì£¼ìš” ì—ëŸ¬ & í•´ê²° ìš”ì•½

1. **ê°€ìƒí™˜ê²½ í™œì„±í™” ì—ëŸ¬**

   * ì›ì¸: ìœˆë„ìš°ìš© `Scripts/activate` ë¥¼ Macì—ì„œ ì‹¤í–‰
   * í•´ê²°: `source venv/bin/activate`

2. **MySQL Access denied(1045)**

   * ì›ì¸: ì‚¬ìš©ì/ë¹„ë°€ë²ˆí˜¸/ê¶Œí•œ ì„¤ì • ë¬¸ì œ
   * í•´ê²°: `mysql -u root` ë¡œ ì ‘ì† í™•ì¸ í›„, `project_user` ê³„ì • ê¶Œí•œ ë‹¤ì‹œ ì„¤ì •

3. **googleapiclient ëª¨ë“ˆ ì—†ìŒ**

   * í•´ê²°: `pip install google-api-python-client ...`

4. **OpenAI ascii UnicodeEncodeError**

   * ì›ì¸: api_keyì— í•œê¸€ ë¬¸ìì—´ ì‚¬ìš©
   * í•´ê²°: `.env` + `settings.OPENAI_API_KEY` êµ¬ì¡°ë¡œ ë³€ê²½

5. **invalid_grant / access_denied (autoppt)**

   * ì›ì¸: ì˜ˆì „ í”„ë¡œì íŠ¸/í´ë¼ì´ì–¸íŠ¸ ì‚¬ìš©
   * í•´ê²°: ìƒˆ GCP í”„ë¡œì íŠ¸ + ìƒˆ OAuth í´ë¼ì´ì–¸íŠ¸ + test user ë“±ë¡

6. **HttpError 404 (File not found í…œí”Œë¦¿)**

   * ì›ì¸: ë‚´ ê³„ì •ì—ì„œ ì ‘ê·¼ ë¶ˆê°€ëŠ¥í•œ ë‹¤ë¥¸ ê³„ì • í…œí”Œë¦¿ ID ì‚¬ìš©
   * í•´ê²°: ë‚´ ê³„ì •ìœ¼ë¡œ ìƒˆ êµ¬ê¸€ ìŠ¬ë¼ì´ë“œ ìƒì„± í›„ ID êµì²´

7. **FileExistsError: í´ë” ì´ë¯¸ ì¡´ì¬**

   * í•´ê²°: `os.makedirs(dir_name, exist_ok=True)` ë¡œ ë³€ê²½

8. **IntegrityError: Column 'ppt_url' cannot be null**

   * ì›ì¸: `create_slides` ì—ì„œ ì˜ˆì™¸ ë°œìƒ ì‹œ `return` ì—†ì´ ëë‚˜ì„œ `ppt_link=None`
   * í•´ê²°:

     * `create_slides` ëì— `return presentation_link`
     * `except` ì—ì„œë„ `return None`
     * `prompt`ì—ì„œ `if not ppt_link:` ì²´í¬ í›„ DB ì €ì¥ ë§‰ê¸°

9. **HttpError 400: Must specify at least one request**

   * ì›ì¸: `requests_update` ë¦¬ìŠ¤íŠ¸ê°€ ë¹„ì–´ ìˆëŠ”ë° `batchUpdate` í˜¸ì¶œ
   * í•´ê²°: `if requests_update:` ì¸ ê²½ìš°ì—ë§Œ `batchUpdate` ìˆ˜í–‰

---

## 9. ì•ìœ¼ë¡œ í•  TODO

* [ ] í…œí”Œë¦¿ë³„ í…ìŠ¤íŠ¸ ë§¤í•‘(`object_index`, `text_list`) ë¡œì§ ë¦¬íŒ©í„°ë§
* [ ] UserHistory ë¦¬ìŠ¤íŠ¸ í˜ì´ì§€ + ìƒì„¸ í˜ì´ì§€ êµ¬í˜„
* [ ] `.env` ì— DB ë¹„ë°€ë²ˆí˜¸, GOOGLE_PROJECT_ID ë“±ë„ ë¶„ë¦¬
* [ ] GitHub Actions / ë°°í¬ ìë™í™” ê³ ë¯¼í•´ë³´ê¸°
* [ ] ìŠ¬ë¼ì´ë“œ ë””ìì¸ í…œí”Œë¦¿ ì—¬ëŸ¬ ê°œ ì„ íƒí•  ìˆ˜ ìˆê²Œ í™•ì¥

---


ì „ì— ë§Œë“¤ì—ˆë˜ í”„ë¡œì íŠ¸ì¸ë° ëŒ€ì¶© ë§Œë“¤ì–´ ë†“ê³  ë‚˜ì¤‘ì— ë‹¤ì‹œ í•œë²ˆ ë³´ê³  ë¶€ì¡±í•œ ë¶€ë¶„ ìˆìœ¼ë©´ ì¢€ ìˆ˜ì •í•´ì•¼ì§€ í–ˆë‹¤ê°€ 1ë…„ì´ ë‹¤ ë˜ì„œ ì—´ì–´ë³´ë‹ˆê¹Œ ê¸°ì–µì´ í•˜ë‚˜ë„ ì•ˆ ë‚œë‹¤ ì¼ì€ ì—­ì‹œ ê·¸ë•Œê·¸ë•Œ í•´ì•¼ê² ë‹¤. ì¨‹ë“  ë­”ê°€ ì „ì€ ìˆì—ˆë‹¤ ê·¼ë° ë¬¸ì œëŠ” ìµœì¢…ì ìœ¼ë¡œ ë‚´ ì„œë²„ì— ì˜¬ë¦¬ê³  ë‹¤ë¥¸ ê³„ì •ìœ¼ë¡œ ì ‘ì†í–ˆì„ ë•Œë„ ì‘ë™ì´ ë˜ì•¼ í•˜ëŠ”ë° ì•ˆ ë  ê²ƒ ê°™ë‹¤ ì¼ë‹¨ ê¸°ëŠ¥ë“¤ë§Œ ë‹¤ ëŒì•„ê°€ê²Œ ë§Œë“¤ì–´ ë†“ê³  ê³ ë¯¼ì¢€ ë” í•´ë´ì•¼ í•  ê²ƒ ê°™ë‹¤.  

